@model DataStructure.Room

@{
    ViewData["Title"] = "Update";
}

<h1>Update</h1>

<h4>Room</h4>

<hr />

<script src="~/lib/jquery/dist/jquery.js"></script>

<script>
    function getRoomIDThroughURL() {
        let currentURL = window.location.toString();
        let roomID = currentURL.substring(currentURL.lastIndexOf('/') + 1);
        let hiddenInputID = $('#roomID');
        hiddenInputID.attr('value', roomID);
    }
    function getRoomTypes() {
        let urlForRoomType = 'https://localhost:44357/api/RoomType';
        $.ajax({
            type: 'GET',
            url: urlForRoomType,
            contentType: 'application/json',
            success: function (data) {
                let roomTypeDropDownList = $('#roomTypeDropDownList');
                $.each(data, function (index, val) {
                    let optionForRoomTypeDropDownList = $('<option>');
                    optionForRoomTypeDropDownList.attr('value', val.id);
                    optionForRoomTypeDropDownList.append(val.name);
                    optionForRoomTypeDropDownList.append('</option>');
                    roomTypeDropDownList.append(optionForRoomTypeDropDownList);
                });
            }

        });
    }
    function updateRoom() {
        $(document).ready(function () {
            getRoomIDThroughURL();
            let btnRoomUpdate = $('#btnRoomUpdate');
            btnRoomUpdate.click(function () {
                let roomID = parseInt($('#roomID').val());
                let roomNumber = parseInt($('#roomNumber').val());
                let roomTypeDropDownList = $('#roomTypeDropDownList');
                let roomType = {
                    id: Number(roomTypeDropDownList.val())
                };
                let room = {
                    id: roomID,
                    number: roomNumber,
                    roomType: roomType
                    /* more info to be added here */
                };
                let url = 'https://localhost:44357/api/Room/' + roomID;
                $.ajax({
                    type: 'PUT',
                    url: url,
                    accepts: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(room),
                    success: function (data) {
                        alert('Success! Edited Room with ID: ' + roomID);
                        window.location.href = "https://localhost:44357/Room/Index";
                    },
                    error: function (data) {
                        alert('Error!: ' + data.responseText);
                    }
                });
            });
        });
    }
</script>

<script type="text/javascript">
    getRoomIDThroughURL();
    getRoomTypes();
    updateRoom();
</script>


<div>
    <input type="hidden" id="roomID" />
</div>

<div style="margin-bottom: 15px">
    <input type="text" name="Room Number" placeholder="Room Number" id="roomNumber" />
</div>

<div style="margin-bottom: 15px">
    <select id="roomTypeDropDownList" name="roomTypeDropDownList">
        <option>Enter The RoomType</option>
    </select>
</div>

<div style="margin-bottom: 15px">
    <input type="submit" name="updateRoom" value="Update The Room" id="btnRoomUpdate" />
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
