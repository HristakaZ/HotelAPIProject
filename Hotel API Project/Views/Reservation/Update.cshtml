@model DataStructure.Reservation

@{
    ViewData["Title"] = "Update";
}

<h1>Update</h1>

<h4>Reservation</h4>

<hr />

<script src="~/lib/jquery/dist/jquery.js"></script>

<script>
    function getReservationIDThroughURL() {
        let currentURL = window.location.toString();
        let reservationID = currentURL.substring(currentURL.lastIndexOf('/') + 1);
        let hiddenInputID = $('#reservationID');
        hiddenInputID.attr('value', reservationID);
    }

    function updateReservation() {
        $(document).ready(function () {
            getReservationIDThroughURL();
            let btnReservationUpdate = $('#btnReservationUpdate');
            btnReservationUpdate.click(function () {
                let reservationID = parseInt($('#reservationID').val());
                let guestDropDownList = $('#guestDropDownList');
                let employeeDropDownList = $('#employeeDropDownList');
                let roomDropDownList = $('#roomDropDownList');
                let guest = {
                    id: Number(guestDropDownList.val())
                };
                let employee = {
                    id: Number(employeeDropDownList.val())
                };
                let roomReservation = {
                    roomID: Number(roomDropDownList.val())
                };
                let reservation = {
                    id: reservationID,
                    guest: guest,
                    employee: employee,
                    roomReservation: roomReservation
                };
                let url = 'https://localhost:44357/api/Reservation/' + reservationID;
                $.ajax({
                    type: 'PUT',
                    url: url,
                    accepts: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(reservation),
                    success: function (data) {
                        alert('Success! Edited Reservation with ID: ' + reservationID);
                        window.location.href = "https://localhost:44357/Reservation/Index";
                    },
                    error: function (data) {
                        alert('Error!: ' + data.responseText);
                    }
                });
            });
        });
    }

    function getGuests() {
        let urlForGuest = 'https://localhost:44357/api/Guest';
        $.ajax({
            type: 'GET',
            url: urlForGuest,
            contentType: 'application/json',
            success: function (data) {
                let guestDropDownList = $('#guestDropDownList');
                $.each(data, function (index, val) {
                    let optionForGuestDropDownList = $('<option>');
                    optionForGuestDropDownList.attr('value', val.id);
                    optionForGuestDropDownList.append(val.name);
                    optionForGuestDropDownList.append('</option>');
                    guestDropDownList.append(optionForGuestDropDownList);
                });
            }

        });
    }

    function getEmployees() {
        let urlForEmployee = 'https://localhost:44357/api/Employee';
        $.ajax({
            type: 'GET',
            url: urlForEmployee,
            contentType: 'application/json',
            success: function (data) {
                let employeeDropDownList = $('#employeeDropDownList');
                $.each(data, function (index, val) {
                    let optionForEmployeeDropDownList = $('<option>');
                    optionForEmployeeDropDownList.attr('value', val.id);
                    optionForEmployeeDropDownList.append(val.userName);
                    optionForEmployeeDropDownList.append('</option>');
                    employeeDropDownList.append(optionForEmployeeDropDownList);
                });
            }

        });
    }

    function getRooms() {
        let urlForRooms = 'https://localhost:44357/api/Room';
        $.ajax({
            type: 'GET',
            url: urlForRooms,
            contentType: 'application/json',
            success: function (data) {
                let roomDropDownList = $('#roomDropDownList');
                $.each(data, function (index, val) {
                    let optionForRoomDropDownList = $('<option>');
                    optionForRoomDropDownList.attr('value', val.id);
                    optionForRoomDropDownList.append(val.number);
                    optionForRoomDropDownList.append('</option>');
                    roomDropDownList.append(optionForRoomDropDownList);
                });
            }

        });
    }
</script>

<script type="text/javascript">
    getReservationIDThroughURL();
    getGuests();
    getEmployees();
    getRooms();
    updateReservation();
</script>


<div>
    <input type="hidden" id="reservationID" />
</div>

<div style="margin-bottom: 15px">
    <input type="text" name="Reservation Date" placeholder="Reservation Date" id="reservationDate" />
</div>

<div style="margin-bottom: 15px">
    <select id="guestDropDownList" name="guestDropDownList">
        <option>Enter The Guest</option>
    </select>
</div>

<div style="margin-bottom: 15px">
    <select id="employeeDropDownList" name="employeeDropDownList">
        <option>Enter The Employee</option>
    </select>
</div>

<div style="margin-bottom: 15px">
    <select id="roomDropDownList" name="roomDropDownList">
        <option>Enter The Room</option>
    </select>
</div>

<div style="margin-bottom: 15px">
    <input type="submit" name="updateReservation" value="Update The Reservation" id="btnReservationUpdate" />
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
